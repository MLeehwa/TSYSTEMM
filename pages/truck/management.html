<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truck Management</title>
    
    <!-- Handsontable CDN -->
    <script src="https://cdn.jsdelivr.net/npm/handsontable@12.3.3/dist/handsontable.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@12.3.3/dist/handsontable.full.min.css">
    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.6/dist/umd/supabase.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .date-filters {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .date-filters input[type="date"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 20px;
            min-height: 700px; /* ìµœì†Œ ë†’ì´ ì¦ê°€ */
            overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .table-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #495057;
            margin: 0;
        }
        
        .table-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Handsontable ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        .handsontable {
            font-size: 14px;
            overflow-x: hidden !important; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        
        .handsontable th {
            background: #f8f9fa !important;
            font-weight: 600 !important;
            color: #495057 !important;
        }
        
        .handsontable td {
            padding: 8px 12px !important;
        }
        
        /* ë“œë¡­ë‹¤ìš´ ê°€ì‹œì„± ë¬¸ì œ í•´ê²° */
        .handsontable .htAutocompleteArrow {
            z-index: 1000 !important;
        }
        
        /* ë“œë¡­ë‹¤ìš´ ë©”ë‰´ í†µí•© ìŠ¤íƒ€ì¼ë§ - ì¤‘ë³µ ì œê±° */
        .htDropdownMenu,
        .handsontable .htDropdownMenu,
        div[class*="htDropdownMenu"] {
            z-index: 99999 !important;
            position: absolute !important;
            background: white !important;
            border: 1px solid #ccc !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
            max-height: 600px !important; /* 4ê°œ ì˜µì…˜ì´ ë³´ì´ë„ë¡ ë†’ì´ ì¦ê°€ */
            min-height: 300px !important; /* ìµœì†Œ ë†’ì´ë„ ì¦ê°€ */
            overflow-y: auto !important;
            overflow-x: hidden !important;
        }
        
        .htDropdownMenu table,
        .handsontable .htDropdownMenu table,
        div[class*="htDropdownMenu"] table {
            width: 100% !important;
            border-collapse: collapse !important;
        }
        
        .htDropdownMenu td,
        .handsontable .htDropdownMenu td,
        div[class*="htDropdownMenu"] td {
            padding: 12px 16px !important;
            border-bottom: 1px solid #eee !important;
            cursor: pointer !important;
            white-space: nowrap !important;
            font-size: 14px !important;
            line-height: 1.4 !important;
            background: white !important;
            color: #333 !important;
        }
        
        .htDropdownMenu td:hover,
        .handsontable .htDropdownMenu td:hover,
        div[class*="htDropdownMenu"] td:hover {
            background-color: #f5f5f5 !important;
            color: #000 !important;
        }
        
        .htDropdownMenu td:last-child,
        .handsontable .htDropdownMenu td:last-child,
        div[class*="htDropdownMenu"] td:last-child {
            border-bottom: none !important;
        }
        
        /* í…Œì´ë¸” ì „ì²´ í¬ê¸° ì¡°ì • */
        #truckTable {
            width: 100% !important;
            height: 600px !important;
            min-height: 600px;
            overflow-x: hidden !important; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        
        .handsontable-container {
            min-height: 400px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow-x: hidden !important; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
        }
        
        .status-scheduled {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-onsite {
            background: #d4edda;
            color: #155724;
        }
        
        .status-shipped {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-delayed {
            background: #f8d7da;
            color: #721c24;
        }
        
                 .status-cancelled {
             background: #e2e3e5;
             color: #383d41;
         }
         
         /* ìƒíƒœë³„ ìƒ‰ìƒ ìŠ¤íƒ€ì¼ - ë” ì§„í•œ ìƒ‰ìƒìœ¼ë¡œ ê°œì„  */
         .status-shipped {
             background: #b8daff;
             color: #004085;
             font-weight: bold;
         }
         
         .status-scheduled {
             background: #fff3cd;
             color: #856404;
             font-weight: bold;
         }
         
         .status-onsite {
             background: #c3e6cb;
             color: #155724;
             font-weight: bold;
         }
         
         /* STATUS ì»¬ëŸ¼ í—¤ë” ìƒ‰ìƒ */
         .status-header-shipped {
             background: #007bff !important;
             color: white !important;
         }
         
         .status-header-scheduled {
             background: #ffc107 !important;
             color: #212529 !important;
         }
         
         .status-header-onsite {
             background: #28a745 !important;
             color: white !important;
         }
         
         /* í–‰ ì „ì²´ ìƒ‰ìƒ ìŠ¤íƒ€ì¼ */
         .row-shipped {
             background-color: #e3f2fd !important;
         }
         
         .row-shipped td {
             background-color: #e3f2fd !important;
             border-color: #2196f3 !important;
         }
         
         .row-scheduled {
             background-color: #fff8e1 !important;
         }
         
         .row-scheduled td {
             background-color: #fff8e1 !important;
             border-color: #ff9800 !important;
         }
         
         .row-onsite {
             background-color: #e8f5e8 !important;
         }
         
         .row-onsite td {
             background-color: #e8f5e8 !important;
             border-color: #4caf50 !important;
         }
         
         /* ì‹¤ì‹œê°„ ìƒíƒœ í‘œì‹œ ìŠ¤íƒ€ì¼ */
         .live-status-container {
             background: white;
             border-radius: 8px;
             box-shadow: 0 2px 10px rgba(0,0,0,0.1);
             padding: 20px;
             margin-bottom: 20px;
         }
         
         .live-status-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 20px;
             padding-bottom: 15px;
             border-bottom: 2px solid #e9ecef;
         }
         
         .live-status-header h3 {
             margin: 0;
             color: #495057;
             font-size: 1.3rem;
         }
         
         .status-controls {
             display: flex;
             gap: 10px;
         }
         
         .btn-sm {
             padding: 6px 12px;
             font-size: 12px;
         }
         
         .btn-outline-info {
             background: transparent;
             color: #17a2b8;
             border: 1px solid #17a2b8;
         }
         
         .btn-outline-info:hover {
             background: #17a2b8;
             color: white;
         }
         
         .btn-outline-secondary {
             background: transparent;
             color: #6c757d;
             border: 1px solid #6c757d;
         }
         
         .btn-outline-secondary:hover {
             background: #6c757d;
             color: white;
         }
         
         .live-status-content {
             min-height: 200px;
             max-height: 400px;
             overflow-y: auto;
         }
         
         .no-status-message {
             text-align: center;
             padding: 40px;
             color: #6c757d;
             font-style: italic;
         }
         
         .live-status-item {
             background: #f8f9fa;
             border-radius: 8px;
             padding: 15px;
             margin-bottom: 15px;
             box-shadow: 0 2px 5px rgba(0,0,0,0.1);
             transition: all 0.3s ease;
         }
         
         .live-status-item:hover {
             transform: translateY(-2px);
             box-shadow: 0 4px 10px rgba(0,0,0,0.15);
         }
         
         .status-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 15px;
             padding-bottom: 10px;
             border-bottom: 1px solid #dee2e6;
         }
         
         .status-icon {
             font-size: 1.5rem;
             margin-right: 10px;
         }
         
         .status-text {
             font-weight: bold;
             font-size: 1.1rem;
             flex-grow: 1;
         }
         
         .update-time {
             color: #6c757d;
             font-size: 0.9rem;
             font-style: italic;
         }
         
         .status-details {
             display: flex;
             flex-direction: column;
             gap: 8px;
         }
         
         .detail-row {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 5px 0;
         }
         
         .label {
             font-weight: 600;
             color: #495057;
             min-width: 80px;
         }
         
         .value {
             color: #212529;
             font-weight: 500;
             text-align: right;
             flex-grow: 1;
             margin-left: 10px;
         }
         
         .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
        }
        
        .error-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .date-filters {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸš› Truck Management</h1>
            <p>Comprehensive truck delivery tracking and management system</p>
        </div>
        
                 <!-- ì»¨íŠ¸ë¡¤ -->
         <div class="controls">
             <div class="date-filters">
                 <label>Select Date:</label>
                <input type="date" id="startDate" onchange="autoFilterByDate()">
                                   <button class="btn btn-warning" onclick="refreshCurrentDateData()">ğŸ”„ í˜„ì¬ ë‚ ì§œ ìƒˆë¡œê³ ì¹¨</button>
             </div>
                         <div>
                 <button class="btn btn-success" onclick="addNewRow()">â• Add New Row</button>
                 <button class="btn btn-warning" onclick="refreshData()">ğŸ”„ Refresh</button>
             </div>
         </div>
        

         
         <!-- í…Œì´ë¸” ì»¨í…Œì´ë„ˆ -->
         <div class="table-container">
             <div class="table-header">
                 <h3 class="table-title">ğŸ“‹ Current Truck Status</h3>
                 <div class="table-actions">
                     <button class="btn btn-success" onclick="addNewRow()">â• Add New Row</button>
                     <button class="btn btn-danger" onclick="deleteLastRow()">ğŸ—‘ï¸ Delete Row</button>
                     <button class="btn btn-primary" onclick="saveAllChanges()">ğŸ’¾ Save All Changes</button>
                 </div>
             </div>
             <div id="truckTableContainer">
                 <div class="loading">
                     <div class="loading-icon">ğŸ”„</div>
                     <div>Loading truck data...</div>
                 </div>
              </div>
          </div>
     </div>
    
    <script>
        // Supabase ì„¤ì •
         const SUPABASE_URL = 'https://wfnihtmmaebgjtdmazmo.supabase.co';
         const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndmbmlodG1tYWViZ2p0ZG1hem1vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NTY3NTcsImV4cCI6MjA2NTMzMjc1N30.FYfdgSvOT1qUvANGlqXCEGvSR2JujggU7T_Sjzys3HQ';
        
                 // ì „ì—­ ë³€ìˆ˜
         let supabase = null;
         let hot = null;
         let currentData = [];
         let originalData = []; // ì›ë³¸ ë°ì´í„° ë°±ì—…
         let hasUnsavedChanges = false;
         let currentDate = '';
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
         console.log('ğŸš€ Truck Management page script executing...');
         
         // DOMì´ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ì´ˆê¸°í™”
         if (document.readyState === 'loading') {
             document.addEventListener('DOMContentLoaded', initializePage);
         } else {
             // DOMì´ ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
             setTimeout(initializePage, 100);
         }
         
         // í˜ì´ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
         function initializePage() {
             console.log('ğŸš€ Initializing Truck Management page...');
             
             // ê¸°ì¡´ ì‹¤ì‹œê°„ ìƒíƒœ ë³µì›
             restoreLiveStatus();
             
             // Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
             waitForSupabase();
             setDefaultDates();
             
             // í˜ì´ì§€ ë¡œë“œ ì‹œ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
             setTimeout(forceDropdownStyling, 100);
             
             // ì£¼ê¸°ì ìœ¼ë¡œ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ í™•ì¸ ë° ì ìš©
             setInterval(forceDropdownStyling, 2000);
             
             console.log('âœ… ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ ìë™ ì ìš© ì„¤ì • ì™„ë£Œ');
         }
         
         // Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ëŒ€ê¸°
         function waitForSupabase() {
             console.log('ğŸ” Checking Supabase library status...');
             
             // supabase-config.jsì—ì„œ ì´ˆê¸°í™”ëœ í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
             if (typeof window.sb !== 'undefined' && window.sb) {
                 console.log('âœ… Supabase client ready from config, using it...');
                 supabase = window.sb;
                 testSupabaseConnection();
             } else if (typeof window.supabase !== 'undefined' && window.supabase) {
                 console.log('âœ… Supabase library ready, initializing...');
                 initializeSupabase();
             } else {
                 console.log('â³ Waiting for Supabase library... (attempt in 200ms)');
                 setTimeout(waitForSupabase, 200);
             }
         }
        
                 // Supabase ì´ˆê¸°í™”
         function initializeSupabase() {
             try {
                 console.log('ğŸ”§ Initializing Supabase...');
                 
                 // supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
                 if (typeof window.supabase === 'undefined') {
                     throw new Error('Supabase library not loaded yet');
                 }
                 
                 // í´ë¼ì´ì–¸íŠ¸ ìƒì„±
                 supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                 console.log('âœ… Supabase client created:', supabase);
                 
                 // ì—°ê²° í…ŒìŠ¤íŠ¸
                 testSupabaseConnection();
                 
             } catch (error) {
                 console.error('âŒ Supabase initialization failed:', error);
                 showError('Supabase ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message);
             }
         }
         
         // Supabase ì—°ê²° í…ŒìŠ¤íŠ¸
         async function testSupabaseConnection() {
             try {
                 console.log('ğŸ” Testing Supabase connection...');
                 
                 // ë¨¼ì € ê°„ë‹¨í•œ í…Œì´ë¸” ì¡´ì¬ ì—¬ë¶€ í™•ì¸
                 const { data, error } = await supabase
                     .from('vwtm_truck_management')
                     .select('count', { count: 'exact', head: true })
                     .limit(1);
                     
                     // í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë‹¤ë¥¸ í…Œì´ë¸”ë¡œ ì‹œë„
                if (error && (error.message.includes('relation') || error.message.includes('does not exist'))) {
                         console.log('ğŸ” Table vwtm_truck_management not found, trying vwtm_list_data...');
                    
                         const { data: altData, error: altError } = await supabase
                             .from('vwtm_list_data')
                             .select('count', { count: 'exact', head: true })
                             .limit(1);
                         
                         if (altError) {
                             throw altError;
                         }
                         
                         console.log('âœ… Alternative table connection successful');
                 } else {
                     console.log('âœ… Supabase connection successful');
                 }
                 
                // ì—°ê²° ì„±ê³µ í›„ ê¸°ë³¸ ë‚ ì§œë¡œ í•„í„°ë§ëœ ë°ì´í„° ë¡œë”©
                await autoFilterByDate();
                 
             } catch (error) {
                 console.error('âŒ Supabase connection test failed:', error);
                 showError('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨: ' + error.message);
             }
         }
        
                 // ê¸°ë³¸ ë‚ ì§œ ì„¤ì •
         function setDefaultDates() {
             const today = new Date();
            const todayString = today.toISOString().split('T')[0];
             
             // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
            document.getElementById('startDate').value = todayString;
            console.log('ğŸ“… Default date set to:', todayString);
            
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì˜¤ëŠ˜ ë‚ ì§œ ë°ì´í„° ë¡œë“œ
            if (supabase) {
                console.log('ğŸš€ Auto-loading data for default date...');
                setTimeout(() => {
                    autoFilterByDate();
                }, 100);
            }
         }
        
                 // íŠ¸ëŸ­ ë°ì´í„° ë¡œë“œ
         async function loadTruckData() {
             try {
                 console.log('ğŸ“Š Loading truck data...');
                 
                 // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ í™•ì¸
                 if (!supabase) {
                     throw new Error('Supabase client not initialized');
                 }
                 
                 console.log('ğŸ” Supabase client status:', !!supabase);
                 showLoading();
                 
                 // ë¨¼ì € vwtm_truck_management í…Œì´ë¸” ì‹œë„ (ëª¨ë“  ë°ì´í„° ë¡œë“œ)
                 let { data, error } = await supabase
                     .from('vwtm_truck_management')
                     .select('*')
                     .order('departure_date', { ascending: false })
                     .order('departure_time', { ascending: true })
                    .limit(1000);
                 
                 // í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° vwtm_list_data ì‹œë„
                 if (error && (error.message.includes('relation') || error.message.includes('does not exist'))) {
                     console.log('ğŸ” Table vwtm_truck_management not found, trying vwtm_list_data...');
                     
                     const result = await supabase
                         .from('vwtm_list_data')
                         .select('*')
                         .order('departure_date', { ascending: false })
                         .order('departure_time', { ascending: true })
                        .limit(1000);
                    
                    if (result.error) {
                        throw result.error;
                    }
                    
                    // vwtm_list_dataì˜ ì»¬ëŸ¼ì„ truck_management í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    data = result.data.map(item => ({
                        departure_date: item.departure_date || item.departure_date,
                        departure_time: item.departure_time || item.departure_time,
                        destination: item.destination || item.location || 'VW US',
                        delivery_no: item.delivery_no || item.delivery_no || '',
                        truck_id: item.truck_id || item.truck_id || '',
                        forza_id: item.forza_id || item.forza_id || '',
                        parts: item.parts || item.parts || '',
                        status: item.status || 'Scheduled'
                    }));
                    
                    error = null;
                 }
                 
                 if (error) throw error;
                 
                 currentData = data || [];
                originalData = [...currentData]; // ì›ë³¸ ë°ì´í„° ë°±ì—…
                 console.log('âœ… Loaded', currentData.length, 'truck records');
                console.log('ğŸ“… Sample data dates:', currentData.slice(0, 3).map(item => item.departure_date));
                 
                 if (currentData.length === 0) {
                     showNoData();
                 } else {
                     displayTable();
                 }
                 
             } catch (error) {
                 console.error('âŒ Error loading data:', error);
                 showError('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ' + error.message);
             }
         }
        
        // ìë™ ë‚ ì§œ í•„í„°ë§ (ë‚ ì§œ ë³€ê²½ ì‹œ ìë™ ì‹¤í–‰)
        async function autoFilterByDate() {
            let selectedDate = document.getElementById('startDate').value;
            
            // ë‚ ì§œê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë‚ ì§œ ì„¤ì •
            if (!selectedDate) {
                const today = new Date();
                selectedDate = today.toISOString().split('T')[0];
                document.getElementById('startDate').value = selectedDate;
                console.log('ğŸ“… No date selected, setting default date:', selectedDate);
            }
            
            console.log('ğŸ” Auto-filtering by date:', selectedDate);
            
            try {
                if (!supabase) {
                    throw new Error('Supabase client not initialized');
                }
                
                showLoading();
                
                // ë‚ ì§œ í˜•ì‹ì„ YYYY-MM-DDë¡œ í†µì¼
                const formattedDate = new Date(selectedDate).toISOString().split('T')[0];
                console.log('ğŸ“… Formatted date for filtering:', formattedDate);
                
                // ì„ íƒëœ ë‚ ì§œì˜ ë°ì´í„°ë§Œ ë¡œë“œ
                let { data, error } = await supabase
                    .from('vwtm_truck_management')
                    .select('*')
                    .eq('departure_date', formattedDate)
                    .order('departure_time', { ascending: true })
                    .limit(1000);
                
                // í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° vwtm_list_data ì‹œë„
                if (error && (error.message.includes('relation') || error.message.includes('does not exist'))) {
                    console.log('ğŸ” Table vwtm_truck_management not found, trying vwtm_list_data...');
                    
                    // vwtm_list_data í…Œì´ë¸”ì—ì„œ ë°ì´í„° ë¡œë“œ (ì»¬ëŸ¼ ë§¤í•‘ ì¡°ì •)
                    const result = await supabase
                        .from('vwtm_list_data')
                        .select('*')
                        .eq('departure_date', formattedDate)
                        .order('departure_time', { ascending: true })
                        .limit(1000);
                    
                    if (result.error) {
                        throw result.error;
                    }
                    
                    // vwtm_list_dataì˜ ì»¬ëŸ¼ì„ truck_management í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    data = result.data.map(item => ({
                        departure_date: item.departure_date || item.departure_date,
                        departure_time: item.departure_time || item.departure_time,
                        destination: item.destination || item.location || 'VW US',
                        delivery_no: item.delivery_no || item.delivery_no || '',
                        truck_id: item.truck_id || item.truck_id || '',
                        forza_id: item.forza_id || item.forza_id || '',
                        parts: item.parts || item.parts || '',
                        status: item.status || 'Scheduled'
                    }));
                    
                    error = null;
                }
                
                if (error) throw error;
                
                currentData = data || [];
                originalData = [...currentData]; // ì›ë³¸ ë°ì´í„° ë°±ì—…
                console.log('âœ… Auto-filtered data loaded:', currentData.length, 'records for', formattedDate);
                console.log('ğŸ“Š Current data structure:', currentData.slice(0, 2));
                
                if (currentData.length === 0) {
                    console.log('ğŸ“­ No data found for date:', formattedDate);
                    // ë°ì´í„°ê°€ ì—†ì–´ë„ í…Œì´ë¸” í‘œì‹œ (ë¹ˆ í–‰ë“¤ë¡œ)
                    displayTable();
                } else {
                    displayTable();
                }
                
                // Handsontable ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœ í™•ì¸
                if (hot) {
                    console.log('ğŸ” Handsontable instance after filtering:', !!hot);
                    console.log('ğŸ” Handsontable data length:', hot.getData().length);
                }
                
            } catch (error) {
                console.error('âŒ Error auto-filtering data:', error);
                showError('ìë™ í•„í„°ë§ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // í…Œì´ë¸” í‘œì‹œ
        function displayTable() {
            const container = document.getElementById('truckTableContainer');
            
            // Handsontableë¡œ í…Œì´ë¸” ìƒì„±
            try {
             if (hot) {
                 hot.destroy();
                    hot = null;
                }
                
                                 // í…Œì´ë¸” ë°ì´í„° ì¤€ë¹„ (8ê°œ ì»¬ëŸ¼)
                 const tableData = currentData.map(truck => [
                     truck.departure_time || '',
                     truck.destination || '',
                     truck.pager_no || '', // pager_no ì¶”ê°€
                     truck.delivery_no || '',
                     truck.truck_id || '',
                     truck.forza_id || '',
                     truck.parts || '',
                     truck.status || ''
                 ]);
                
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ 6í–‰ í‘œì‹œ, ìˆìœ¼ë©´ 1í–‰ ì¶”ê°€
                if (currentData.length === 0) {
                                         for (let i = 0; i < 6; i++) {
                         tableData.push([
                             '',            // departure_time
                             'VW US',      // destination (ê¸°ë³¸ê°’)
                             '',            // pager_no
                             '',            // delivery_no
                             '',            // truck_id
                             '',            // forza_id
                             '',            // parts
                             'Scheduled'    // status (ê¸°ë³¸ê°’)
                         ]);
                     }
                } else {
                                         // ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ 1í–‰ë§Œ ì¶”ê°€
                     tableData.push([
                         '',            // departure_time
                         'VW US',      // destination (ê¸°ë³¸ê°’)
                         '',            // pager_no
                         '',            // delivery_no
                         '',            // truck_id
                         '',            // forza_id
                         '',            // parts
                         'Scheduled'    // status (ê¸°ë³¸ê°’)
                     ]);
                }
             
             hot = new Handsontable(container, {
                    data: tableData,
                    rowHeaders: true,
                    colHeaders: ['ETD Time', 'Destination', 'Pager No', 'Delivery No', 'Truck ID', 'Forza ID', 'Parts', 'Status'],
                    columns: [
                        { type: 'time', timeFormat: 'HH:mm', correctFormat: true, width: 120 },
                        { 
                            type: 'dropdown', 
                            source: ['VW US', 'VW MX', 'KMX'],
                            strict: false,
                            width: 180,
                            allowInvalid: false,
                            allowEmpty: false,
                            renderer: function(instance, td, row, col, prop, value, cellProperties) {
                                // ETD ì‹œê°„ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¹„í™œì„±í™” í‘œì‹œ
                                const etdTime = instance.getDataAtRowProp(row, '0');
                                if (!etdTime || etdTime.trim() === '') {
                                    td.innerHTML = 'â° ETD ì…ë ¥';
                                    td.style.backgroundColor = '#f8f9fa';
                                    td.style.color = '#6c757d';
                                    td.style.fontStyle = 'italic';
                                    td.style.cursor = 'not-allowed';
                                    return td;
                                }
                                // ETD ì‹œê°„ì´ ìˆìœ¼ë©´ ì •ìƒì ìœ¼ë¡œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
                                Handsontable.renderers.DropdownRenderer.apply(this, arguments);
                                td.style.cursor = 'pointer';
                                return td;
                            }
                        },
                        { type: 'text', width: 100 },
                        { type: 'text', width: 120 },
                        { type: 'text', width: 100 },
                        { type: 'text', width: 100 },
                        { type: 'text', width: 150 },
                        { 
                            type: 'dropdown', 
                            source: ['Shipped', 'Scheduled', 'On Site'],
                            strict: false,
                            width: 180,
                            allowInvalid: false,
                            allowEmpty: false,
                            renderer: function(instance, td, row, col, prop, value, cellProperties) {
                                 // ETD ì‹œê°„ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¹„í™œì„±í™” í‘œì‹œ
                                 const etdTime = instance.getDataAtRowProp(row, '0');
                                 if (!etdTime || etdTime.trim() !== '') {
                                     // ETD ì‹œê°„ì´ ìˆìœ¼ë©´ ìƒíƒœë³„ ìƒ‰ìƒ ì ìš© (ë” ì§„í•œ ìƒ‰ìƒ)
                                     if (value && value.trim() !== '') {
                                         switch (value) {
                                             case 'Shipped':
                                                 td.style.backgroundColor = '#b8daff'; // ì§„í•œ íŒŒë€ìƒ‰
                                                 td.style.color = '#004085';
                                                 td.style.fontWeight = 'bold';
                                                 td.style.border = '2px solid #007bff';
                                                 break;
                                             case 'Scheduled':
                                                 td.style.backgroundColor = '#fff3cd'; // ë…¸ë€ìƒ‰
                                                 td.style.color = '#856404';
                                                 td.style.fontWeight = 'bold';
                                                 td.style.border = '2px solid #ffc107';
                                                 break;
                                             case 'On Site':
                                                 td.style.backgroundColor = '#c3e6cb'; // ì§„í•œ ì´ˆë¡ìƒ‰
                                                 td.style.color = '#155724';
                                                 td.style.fontWeight = 'bold';
                                                 td.style.border = '2px solid #28a745';
                                                 break;
                                             default:
                                                 td.style.backgroundColor = '#ffffff';
                                                 td.style.color = '#000000';
                                                 td.style.border = '1px solid #dee2e6';
                                         }
                                     } else {
                                         td.style.backgroundColor = '#ffffff';
                                         td.style.color = '#000000';
                                         td.style.border = '1px solid #dee2e6';
                                     }
                                 } else {
                                     // ETD ì‹œê°„ì´ ì—†ìœ¼ë©´ ë¹„í™œì„±í™” í‘œì‹œ
                                     td.innerHTML = 'â° ETD ì…ë ¥';
                                     td.style.backgroundColor = '#f8f9fa';
                                     td.style.color = '#6c757d';
                                     td.style.fontStyle = 'italic';
                                     td.style.cursor = 'not-allowed';
                                     td.style.border = '1px solid #dee2e6';
                                     return td;
                                 }
                                 
                                 // ë“œë¡­ë‹¤ìš´ ë Œë”ëŸ¬ ì ìš©
                                 Handsontable.renderers.DropdownRenderer.apply(this, arguments);
                                 td.style.cursor = 'pointer';
                                 return td;
                             }
                         }
                    ],
                width: '100%',
                height: 600, // ë†’ì´ë¥¼ 600pxë¡œ ì¦ê°€
                minSpareRows: 1,
                stretchH: 'last', // ë§ˆì§€ë§‰ ì»¬ëŸ¼ì„ ëŠ˜ë ¤ì„œ ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€
                autoWrapRow: true,
                afterChange: function(changes, source) {
                    if (source === 'edit' && changes && changes.length > 0) {
                        console.log('ğŸ”„ afterChange triggered:', changes);
                        changes.forEach(change => {
                            const [row, prop, oldValue, newValue] = change;
                            console.log(`ğŸ“ Change: Row ${row}, Prop ${prop}, Old: "${oldValue}", New: "${newValue}"`);
                            
                            // Pager No ì»¬ëŸ¼ (ì¸ë±ìŠ¤ 2)ì— ê°’ì´ ì…ë ¥ë˜ë©´
                            if (prop === 2 && newValue && newValue.trim() !== '') {
                                console.log(`ğŸ“± Pager No entered: "${newValue}" in row ${row}`);
                                // í˜„ì¬ Status í™•ì¸
                                const currentStatus = hot.getDataAtRowProp(row, 7);
                                console.log(`ğŸ“Š Current status in row ${row}: "${currentStatus}"`);
                                
                                if (currentStatus === 'Scheduled') {
                                    console.log(`ğŸ”„ Changing status from 'Scheduled' to 'On Site' in row ${row}`);
                                    hot.setDataAtRowProp(row, 7, 'On Site');
                                    console.log(`âœ… Status changed successfully in row ${row}`);
                                }
                            }
                            
                            // Status ì»¬ëŸ¼ (ì¸ë±ìŠ¤ 7)ì´ Shippedë¡œ ë³€ê²½ë˜ë©´
                            if (prop === 7 && newValue === 'Shipped') {
                                console.log(`ğŸšš Status changed to 'Shipped' in row ${row}`);
                                // Pager Noë¥¼ ê³µë€ìœ¼ë¡œ ë³€ê²½
                                const currentPagerNo = hot.getDataAtRowProp(row, 2);
                                if (currentPagerNo && currentPagerNo.trim() !== '') {
                                    console.log(`ğŸ—‘ï¸ Clearing Pager No "${currentPagerNo}" in row ${row}`);
                                    hot.setDataAtRowProp(row, 2, '');
                                    console.log(`âœ… Pager No cleared successfully in row ${row}`);
                                }
                            }
                        });
                    }
                },
                licenseKey: 'non-commercial-and-evaluation',
                                 afterChange: function(changes, source) {
                         if (source === 'loadData') return;
                         
                         hasUnsavedChanges = true;
                         updateSaveButton();
                         
                         // ETD ì‹œê°„ì´ ë³€ê²½ë˜ë©´ í•´ë‹¹ í–‰ì˜ ë‹¤ë¥¸ ì»¬ëŸ¼ë“¤ì„ í™œì„±í™”
                         if (changes && changes.length > 0) {
                             changes.forEach(([row, prop, oldValue, newValue]) => {
                                 if (prop === '0' && newValue && newValue.trim() !== '') {
                                     // ETD ì‹œê°„ì´ ì…ë ¥ë˜ë©´ í•´ë‹¹ í–‰ì˜ destinationê³¼ statusë¥¼ í™œì„±í™”
                                     console.log(`â° ETD ì‹œê°„ ì…ë ¥ë¨: í–‰ ${row}, ì‹œê°„: ${newValue}`);
                                     // í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì»¬ëŸ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                                     setTimeout(() => {
                                         if (hot) {
                                             hot.render();
                                         }
                                     }, 100);
                                 }
                                 
                                 // STATUS ë³€ê²½ ì‹œ í•´ë‹¹ í–‰ ì „ì²´ ìƒ‰ìƒ ë³€ê²½ ë° ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
                                 if (prop === '7' && newValue && newValue.trim() !== '') {
                                     console.log(`ğŸ¨ Status ë³€ê²½ë¨: í–‰ ${row}, ìƒíƒœ: ${newValue}`);
                                     updateRowColor(row, newValue);
                                     
                                     // ì‹¤ì‹œê°„ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
                                     updateLiveStatusDisplay(row, newValue);
                                 }
                             });
                         }
                         
                         // ìë™ ì €ì¥ ê¸°ëŠ¥ (5ì´ˆ í›„) - ì„¤ì •ì— ë”°ë¼ í™œì„±í™”/ë¹„í™œì„±í™”
                         // if (autoSaveEnabled && hasUnsavedChanges) {
                         //     if (window.autoSaveTimer) {
                         //         clearTimeout(window.autoSaveTimer);
                         //     }
                         
                         //     window.autoSaveTimer = setTimeout(() => {
                         //         if (hasUnsavedChanges) {
                         if (hasUnsavedChanges) {
                             if (window.autoSaveTimer) {
                                 clearTimeout(window.autoSaveTimer);
                             }
                             
                             window.autoSaveTimer = setTimeout(() => {
                                 if (hasUnsavedChanges) {
                                     console.log('ğŸ”„ Auto-saving changes...');
                                     saveAllChanges();
                                 }
                             }, 5000); // 5ì´ˆ í›„ ìë™ ì €ì¥
                         }
                     }
                });
                
                                 console.log('âœ… Handsontable initialized successfully');
                 console.log('ğŸ” Table data length:', tableData.length);
                 console.log('ğŸ” Hot instance created:', !!hot);
                 console.log('ğŸ” Empty rows added:', currentData.length === 0 ? 6 : 1);
                 
                 // ì „ì—­ ë³€ìˆ˜ ìƒíƒœ í™•ì¸
                 console.log('ğŸ” Global currentData length:', currentData.length);
                 console.log('ğŸ” Global originalData length:', originalData.length);
                 
                                                     // ì´ˆê¸° ë°ì´í„°ì— ëŒ€í•œ í–‰ ìƒ‰ìƒ ì ìš© ë° ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
                  setTimeout(() => {
                      if (hot) {
                          tableData.forEach((row, index) => {
                              if (row[7] && row[7].trim() !== '') { // STATUS ì»¬ëŸ¼
                                  updateRowColor(index, row[7]);
                                  
                                  // ê¸°ì¡´ ë°ì´í„°ì— ëŒ€í•œ ì‹¤ì‹œê°„ ìƒíƒœë„ ì—…ë°ì´íŠ¸
                                  if (row[0] && row[0].trim() !== '') { // ETD ì‹œê°„ì´ ìˆëŠ” ê²½ìš°ë§Œ
                                      console.log(`ğŸ“¡ Initializing live status for row ${index + 1}: ${row[7]}`);
                                      updateLiveStatusDisplay(index, row[7]);
                                  }
                              }
                          });
                          
                                                     // ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
                           forceDropdownStyling();
                           
                           // ë“œë¡­ë‹¤ìš´ í‘œì‹œ ì‹œ ìë™ ìŠ¤íƒ€ì¼ ì ìš©
                           if (hot) {
                               hot.updateSettings({
                                   afterDropdownMenuShow: function() {
                                       setTimeout(forceDropdownStyling, 50);
                                   }
                               });
                               
                               // ì¶”ê°€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
                               document.addEventListener('click', function(e) {
                                   if (e.target.closest('.htDropdownMenu') || e.target.closest('[class*="htDropdownMenu"]')) {
                                       setTimeout(forceDropdownStyling, 10);
                                   }
                               });
                               
                               // DOM ë³€ê²½ ê°ì§€í•˜ì—¬ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ ìë™ ì ìš©
                               const observer = new MutationObserver(function(mutations) {
                                   mutations.forEach(function(mutation) {
                                       if (mutation.type === 'childList') {
                                           mutation.addedNodes.forEach(function(node) {
                                               if (node.nodeType === 1 && (node.classList.contains('htDropdownMenu') || node.className.includes('htDropdownMenu'))) {
                                                   setTimeout(forceDropdownStyling, 10);
                                               }
                                           });
                                       }
                                   });
                               });
                               
                               observer.observe(document.body, {
                                   childList: true,
                                   subtree: true
                               });
                               
                               console.log('âœ… ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
                           }
                      }
                  }, 200);
                
            } catch (error) {
                console.error('âŒ Error creating table:', error);
                showError('í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨: ' + error.message);
            }
        }
        
                 // ë§ˆì§€ë§‰ í–‰ ì‚­ì œ
         function deleteLastRow() {
             if (!hot) {
                 console.warn('âš ï¸ í…Œì´ë¸”ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                 return;
             }
             
             const currentTableData = hot.getData();
             if (currentTableData.length <= 1) {
                 console.warn('âš ï¸ ìµœì†Œ 1í–‰ì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.');
                 return;
             }
             
             console.log('ğŸ—‘ï¸ Deleting last row...');
             
             // ë§ˆì§€ë§‰ í–‰ ì œê±°
             currentTableData.pop();
             hot.loadData(currentTableData);
             
             // ì „ì—­ ìƒíƒœ ì—…ë°ì´íŠ¸
             currentData = currentTableData;
             hasUnsavedChanges = true;
             updateSaveButton();
             
             console.log('âœ… Last row deleted successfully');
         }
         
                 // ì‹¤ì‹œê°„ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateLiveStatusDisplay(row, status) {
            if (!hot) return;
            
            try {
                // í˜„ì¬ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const rowData = hot.getDataAtRow(row);
                const etdTime = rowData[0];
                const destination = rowData[1];
                const pagerNo = rowData[2];
                const deliveryNo = rowData[3];
                const truckId = rowData[4];
                const forzaId = rowData[5];
                const parts = rowData[6];
                
                // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
                const selectedDate = document.getElementById('startDate').value;
                
                // ìƒíƒœ ë³€ê²½ ì‹œê°„ ê¸°ë¡
                const statusChangeTime = new Date().toLocaleTimeString('ko-KR');
                
                // ì‹¤ì‹œê°„ ìƒíƒœ ì •ë³´ ê°ì²´ ìƒì„± (ë‚ ì§œ ì •ë³´ í¬í•¨)
                const liveStatus = {
                    row: row + 1, // ì‚¬ìš©ì ì¹œí™”ì ì¸ í–‰ ë²ˆí˜¸ (1ë¶€í„° ì‹œì‘)
                    departureDate: selectedDate, // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ
                    etdTime: etdTime,
                    destination: destination,
                    pagerNo: pagerNo,
                    deliveryNo: deliveryNo,
                    truckId: truckId,
                    forzaId: forzaId,
                    parts: parts,
                    status: status,
                    lastUpdated: statusChangeTime,
                    timestamp: Date.now()
                };
                
                // ì „ì—­ ìƒíƒœ ì €ì¥ (ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥)
                if (!window.liveTruckStatus) {
                    window.liveTruckStatus = {};
                }
                window.liveTruckStatus[row] = liveStatus;
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ìœ ì§€)
                localStorage.setItem('liveTruckStatus', JSON.stringify(window.liveTruckStatus));
                
                // ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸ ë°œìƒ (ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°ì§€ ê°€ëŠ¥)
                const statusChangeEvent = new CustomEvent('truckStatusChanged', {
                    detail: liveStatus
                });
                window.dispatchEvent(statusChangeEvent);
                
                console.log(`ğŸ“¡ Live status updated for row ${row + 1}:`, liveStatus);
                
                // ì‹¤ì‹œê°„ ìƒíƒœ í‘œì‹œ ì˜ì—­ ì—…ë°ì´íŠ¸ (ìˆëŠ” ê²½ìš°)
                updateStatusDisplayArea(liveStatus);
                
            } catch (error) {
                console.error('âŒ Error updating live status display:', error);
            }
        }
         
         // í–‰ ì „ì²´ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
         function updateRowColor(row, status) {
             if (!hot) return;
             
             const rowElement = hot.getCell(row, 0).parentElement;
             if (!rowElement) return;
             
             // ê¸°ì¡´ ìƒ‰ìƒ í´ë˜ìŠ¤ ì œê±°
             rowElement.classList.remove('row-shipped', 'row-scheduled', 'row-onsite');
             
             // ìƒˆë¡œìš´ ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ í´ë˜ìŠ¤ ì¶”ê°€
             switch (status) {
                 case 'Shipped':
                     rowElement.classList.add('row-shipped');
                     break;
                 case 'Scheduled':
                     rowElement.classList.add('row-scheduled');
                     break;
                 case 'On Site':
                     rowElement.classList.add('row-onsite');
                     break;
             }
             
                              console.log(`ğŸ¨ Row ${row} ìƒ‰ìƒ ì—…ë°ì´íŠ¸: ${status}`);
         }
         
         // ì‹¤ì‹œê°„ ìƒíƒœ ìƒˆë¡œê³ ì¹¨
         function refreshLiveStatus() {
             try {
                 // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìƒíƒœ ì •ë³´ ë³µì›
                 const storedStatus = localStorage.getItem('liveTruckStatus');
                 if (storedStatus) {
                     window.liveTruckStatus = JSON.parse(storedStatus);
                     
                     // ëª¨ë“  ìƒíƒœ í•­ëª©ì„ í‘œì‹œ ì˜ì—­ì— ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                     const statusDisplayArea = document.getElementById('liveStatusDisplay');
                     if (statusDisplayArea) {
                         statusDisplayArea.innerHTML = '';
                         
                         Object.values(window.liveTruckStatus).forEach(status => {
                             updateStatusDisplayArea(status);
                         });
                         
                         if (Object.keys(window.liveTruckStatus).length === 0) {
                             showNoStatusMessage();
                         }
                     }
                     
                     console.log('ğŸ”„ Live status refreshed');
                 } else {
                     showNoStatusMessage();
                 }
             } catch (error) {
                 console.error('âŒ Error refreshing live status:', error);
                 showNoStatusMessage();
             }
         }
         
         // ì‹¤ì‹œê°„ ìƒíƒœ ì§€ìš°ê¸°
         function clearLiveStatus() {
             if (confirm('ëª¨ë“  ì‹¤ì‹œê°„ ìƒíƒœ ì •ë³´ë¥¼ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                 window.liveTruckStatus = {};
                 localStorage.removeItem('liveTruckStatus');
                 
                 const statusDisplayArea = document.getElementById('liveStatusDisplay');
                 if (statusDisplayArea) {
                     showNoStatusMessage();
                 }
                 
                 console.log('ğŸ—‘ï¸ Live status cleared');
             }
         }
         
         // ê¸°ì¡´ ì‹¤ì‹œê°„ ìƒíƒœ ë³µì›
         function restoreLiveStatus() {
             try {
                 // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìƒíƒœ ì •ë³´ ë³µì›
                 const storedStatus = localStorage.getItem('liveTruckStatus');
                 if (storedStatus) {
                     window.liveTruckStatus = JSON.parse(storedStatus);
                     console.log('ğŸ“¡ Live status restored from storage');
                     
                     // í˜ì´ì§€ ë¡œë“œ í›„ ìƒíƒœ í‘œì‹œ ì˜ì—­ì— í‘œì‹œ
                     setTimeout(() => {
                         if (Object.keys(window.liveTruckStatus).length > 0) {
                             Object.values(window.liveTruckStatus).forEach(status => {
                                 updateStatusDisplayArea(status);
                             });
                         }
                     }, 500);
                 } else {
                     console.log('ğŸ“¡ No stored live status found');
                 }
             } catch (error) {
                 console.error('âŒ Error restoring live status:', error);
             }
         }
         
         // ìƒíƒœ ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ
         function showNoStatusMessage() {
             const statusDisplayArea = document.getElementById('liveStatusDisplay');
             if (statusDisplayArea) {
                 statusDisplayArea.innerHTML = `
                     <div class="no-status-message">
                         <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ“¡</div>
                         <div>ìƒíƒœ ë³€ê²½ ì‹œ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤</div>
                     </div>
                 `;
             }
         }
         
         // ì‹¤ì‹œê°„ ìƒíƒœ í‘œì‹œ ì˜ì—­ ì—…ë°ì´íŠ¸
         function updateStatusDisplayArea(liveStatus) {
             // ì‹¤ì‹œê°„ ìƒíƒœ í‘œì‹œ ì˜ì—­ì´ ìˆëŠ”ì§€ í™•ì¸
             const statusDisplayArea = document.getElementById('liveStatusDisplay');
             if (!statusDisplayArea) return;
             
             try {
                 // ìƒíƒœë³„ ì•„ì´ì½˜ê³¼ ìƒ‰ìƒ ì„¤ì •
                 let statusIcon, statusColor, statusText;
                 switch (liveStatus.status) {
                     case 'Shipped':
                         statusIcon = 'ğŸšš';
                         statusColor = '#007bff';
                         statusText = 'ë°°ì†¡ ì¤‘';
                         break;
                     case 'Scheduled':
                         statusIcon = 'â°';
                         statusColor = '#ffc107';
                         statusText = 'ì˜ˆì •ë¨';
                         break;
                     case 'On Site':
                         statusIcon = 'ğŸ“';
                         statusColor = '#28a745';
                         statusText = 'í˜„ì¥ ë„ì°©';
                         break;
                     default:
                         statusIcon = 'â“';
                         statusColor = '#6c757d';
                         statusText = 'ì•Œ ìˆ˜ ì—†ìŒ';
                 }
                 
                 // ì‹¤ì‹œê°„ ìƒíƒœ í‘œì‹œ HTML ìƒì„±
                 const statusHTML = `
                     <div class="live-status-item" style="border-left: 4px solid ${statusColor};">
                         <div class="status-header">
                             <span class="status-icon">${statusIcon}</span>
                             <span class="status-text" style="color: ${statusColor};">${statusText}</span>
                             <span class="update-time">${liveStatus.lastUpdated}</span>
                         </div>
                         <div class="status-details">
                             <div class="detail-row">
                                 <span class="label">í–‰:</span>
                                 <span class="value">${liveStatus.row}</span>
                                 <span class="label">ETD:</span>
                                 <span class="value">${liveStatus.etdTime || 'ë¯¸ì„¤ì •'}</span>
                             </div>
                             <div class="detail-row">
                                 <span class="label">ëª©ì ì§€:</span>
                                 <span class="value">${liveStatus.destination || 'ë¯¸ì„¤ì •'}</span>
                                 <span class="label">Pager:</span>
                                 <span class="value">${liveStatus.pagerNo || 'ë¯¸ì„¤ì •'}</span>
                             </div>
                             <div class="detail-row">
                                 <span class="label">ë°°ì†¡ë²ˆí˜¸:</span>
                                 <span class="value">${liveStatus.deliveryNo || 'ë¯¸ì„¤ì •'}</span>
                                 <span class="label">íŠ¸ëŸ­ID:</span>
                                 <span class="value">${liveStatus.truckId || 'ë¯¸ì„¤ì •'}</span>
                             </div>
                         </div>
                     </div>
                 `;
                 
                 // ê¸°ì¡´ ìƒíƒœ í•­ëª©ì´ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ì¶”ê°€
                 const existingItem = statusDisplayArea.querySelector(`[data-row="${liveStatus.row}"]`);
                 if (existingItem) {
                     existingItem.outerHTML = statusHTML;
                 } else {
                     statusDisplayArea.insertAdjacentHTML('afterbegin', statusHTML);
                 }
                 
                 // ìµœì‹  ìƒíƒœë¥¼ ë§¨ ìœ„ë¡œ ì´ë™
                 const newItem = statusDisplayArea.querySelector(`[data-row="${liveStatus.row}"]`);
                 if (newItem && statusDisplayArea.firstChild !== newItem) {
                     statusDisplayArea.insertBefore(newItem, statusDisplayArea.firstChild);
                 }
                 
                 console.log(`ğŸ“º Status display area updated for row ${liveStatus.row}`);
                 
             } catch (error) {
                 console.error('âŒ Error updating status display area:', error);
             }
         }
         
         // ìë™ ì €ì¥ í† ê¸€ í•¨ìˆ˜ ì œê±° - ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•ŠìŒ
         // function toggleAutoSave() {
         //     // ìë™ ì €ì¥ ê¸°ëŠ¥ì´ ì œê±°ë¨
         // }
         
         // ìƒˆ í–‰ ì¶”ê°€
         function addNewRow() {
            if (!hot) {
                console.warn('âš ï¸ í…Œì´ë¸”ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('â• Adding new row...');
            
            const currentTableData = hot.getData();
                         const newRow = [
                 '',            // departure_time
                 'VW US',      // destination (ê¸°ë³¸ê°’)
                 '',            // pager_no
                 '',            // delivery_no
                 '',            // truck_id
                 '',            // forza_id
                 '',            // parts
                 'Scheduled'    // status (ê¸°ë³¸ê°’)
             ];
            
            currentTableData.push(newRow);
            hot.loadData(currentTableData);
            
            // ì „ì—­ ìƒíƒœ ì—…ë°ì´íŠ¸
            currentData = currentTableData;
            hasUnsavedChanges = true;
            updateSaveButton();
            
            console.log('âœ… New row added successfully');
        }
        
        // ëª¨ë“  ë³€ê²½ì‚¬í•­ ì €ì¥
        async function saveAllChanges() {
            try {
                if (!hot) {
                    console.warn('âš ï¸ í…Œì´ë¸”ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const data = hot.getData();
                if (!data || data.length === 0) {
                    console.warn('âš ï¸ ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                console.log('ğŸ’¾ Saving all changes...');
                console.log('ğŸ“Š Raw table data:', data);
                
                // ì €ì¥ ê°€ëŠ¥í•œ ë°ì´í„°ë§Œ í•„í„°ë§ (ETD ì‹œê°„ì´ ìˆëŠ” í–‰ë§Œ)
                const validData = data.filter((row, index) => {
                    const hasEtdTime = row[0] && row[0].trim() !== '';
                    console.log(`ğŸ” Row ${index}: ETD Time = "${row[0]}", Valid = ${hasEtdTime}`);
                    return hasEtdTime; // departure_timeì´ ìˆëŠ” í–‰ë§Œ
                });
                
                if (validData.length === 0) {
                    console.warn('âš ï¸ ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ETD ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                console.log(`ğŸ“Š Valid data found: ${validData.length} rows with ETD time`);
                console.log('ğŸ“Š Valid rows:', validData);
                
                // ë³€ê²½ëœ ë°ì´í„°ë§Œ ì°¾ê¸°
                const changedData = [];
                const newData = [];
                
                validData.forEach((row, index) => {
                    const selectedDate = document.getElementById('startDate').value;
                    const formattedDate = new Date(selectedDate).toISOString().split('T')[0];
                    
                                             // 8ê°œ ì»¬ëŸ¼ ë°ì´í„°ë¡œ DB ì €ì¥ (ê³µë€ë„ ë¹ˆ ë¬¸ìì—´ë¡œ ì €ì¥)
                         const truckData = {
                             departure_date: formattedDate, // ë‚ ì§œëŠ” ìƒë‹¨ í•„í„°ì—ì„œ ê´€ë¦¬í•˜ê³  í˜•ì‹ í†µì¼
                             departure_time: row[0], // ETD ì‹œê°„ (í•„ìˆ˜)
                             destination: row[1] || '', // ê³µë€ì´ë©´ ë¹ˆ ë¬¸ìì—´
                             pager_no: row[2] || '', // ê³µë€ì´ë©´ ë¹ˆ ë¬¸ìì—´
                             delivery_no: row[3] || '', // ê³µë€ì´ë©´ ë¹ˆ ë¬¸ìì—´
                             truck_id: row[4] || '', // ê³µë€ì´ë©´ ë¹ˆ ë¬¸ìì—´
                             forza_id: row[5] || '', // ê³µë€ì´ë©´ ë¹ˆ ë¬¸ìì—´
                             parts: row[6] || '', // ê³µë€ì´ë©´ ë¹ˆ ë¬¸ìì—´
                             status: row[7] || 'Scheduled' // ê¸°ë³¸ê°’ ë˜ëŠ” ê³µë€ì´ë©´ ê¸°ë³¸ê°’
                         };
                    
                    console.log(`ğŸ“ Processing row ${index}:`, truckData);
                    console.log(`ğŸ“ Row ${index} details:`, {
                        'ETD Time': `"${row[0]}"`,
                        'Destination': `"${row[1] || 'ê³µë€'}"`,
                        'Pager No': `"${row[2] || 'ê³µë€'}"`,
                        'Delivery No': `"${row[3] || 'ê³µë€'}"`,
                        'Truck ID': `"${row[4] || 'ê³µë€'}"`,
                        'Forza ID': `"${row[5] || 'ê³µë€'}"`,
                        'Parts': `"${row[6] || 'ê³µë€'}"`,
                        'Status': `"${row[7] || 'ê³µë€'}"`
                    });
                    
                    // ìƒˆ ë°ì´í„°ì¸ì§€ ê¸°ì¡´ ë°ì´í„° ìˆ˜ì •ì¸ì§€ í™•ì¸
                    if (index < originalData.length) {
                        // ê¸°ì¡´ ë°ì´í„° ìˆ˜ì •
                        const original = originalData[index];
                        if (JSON.stringify(truckData) !== JSON.stringify(original)) {
                            changedData.push({
                                ...truckData,
                                id: original.id
                            });
                            console.log(`ğŸ“ Row ${index} marked for UPDATE`);
                        } else {
                            console.log(`ğŸ“ Row ${index} unchanged, skipping`);
                        }
                    } else {
                        // ìƒˆ ë°ì´í„°
                        newData.push(truckData);
                        console.log(`ğŸ“ Row ${index} marked for INSERT`);
                    }
                });
                
                console.log(`ğŸ“Š Changes detected: ${changedData.length} updates, ${newData.length} new records`);
                
                if (changedData.length > 0) {
                    console.log('ğŸ“ Data to UPDATE:', changedData);
                }
                if (newData.length > 0) {
                    console.log('ğŸ“ Data to INSERT:', newData);
                }
                
                let successCount = 0;
                
                // ê¸°ì¡´ ë°ì´í„° ì—…ë°ì´íŠ¸
                if (changedData.length > 0) {
                    console.log('ğŸ”„ Updating existing records...');
                    for (const truck of changedData) {
                        const { error } = await supabase
                            .from('vwtm_truck_management')
                            .update(truck)
                            .eq('id', truck.id);
                        
                        if (error) {
                            console.error(`âŒ Update error for ID ${truck.id}:`, error);
                            throw error;
                        }
                        successCount++;
                        console.log(`âœ… Updated record ID ${truck.id}`);
                    }
                }
                
                // ìƒˆ ë°ì´í„° ì¶”ê°€
                if (newData.length > 0) {
                    console.log('â• Inserting new records...');
                    const { error } = await supabase
                        .from('vwtm_truck_management')
                        .insert(newData);
                    
                    if (error) {
                        console.error('âŒ Insert error:', error);
                        throw error;
                    }
                    successCount += newData.length;
                    console.log(`âœ… Inserted ${newData.length} new records`);
                }
                
                console.log('âœ… All changes saved successfully');
                console.log(`âœ… ì €ì¥ ì™„ë£Œ! ${successCount}ê°œ í•­ëª©ì´ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                await autoFilterByDate();
                hasUnsavedChanges = false;
                updateSaveButton();
                
            } catch (error) {
                console.error('âŒ Save error:', error);
                console.warn('âš ï¸ ì €ì¥ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSaveButton() {
            const saveButton = document.querySelector('button[onclick="saveAllChanges()"]');
            if (saveButton) {
                if (hasUnsavedChanges) {
                    saveButton.textContent = 'ğŸ’¾ Save All Changes*';
                    saveButton.className = 'btn btn-warning';
                } else {
                    saveButton.textContent = 'ğŸ’¾ Save All Changes';
                    saveButton.className = 'btn btn-success';
                }
            }
        }
        
        // íŠ¸ëŸ­ ì‚­ì œ
        async function deleteTruck(index) {
            if (!confirm('ì •ë§ ì´ íŠ¸ëŸ­ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const truck = currentData[index];
                const { error } = await supabase
                    .from('vwtm_truck_management')
                    .delete()
                    .eq('id', truck.id);
                
                if (error) throw error;
                
                console.log('âœ… Truck deleted successfully');
                console.log('âœ… íŠ¸ëŸ­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                await loadTruckData();
                
            } catch (error) {
                console.error('âŒ Delete error:', error);
                console.warn('âš ï¸ ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
             }
         }

        // ë¹ˆ í–‰ ì‚­ì œ
        async function deleteEmptyRow(row) {
            if (!confirm('ì •ë§ ì´ ë¹ˆ í–‰ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const emptyRow = hot.getDataAtRow(row);
                const { error } = await supabase
                    .from('vwtm_truck_management')
                    .delete()
                    .eq('id', emptyRow.id);
                
                if (error) throw error;

                console.log('âœ… Empty row deleted successfully');
                console.log('âœ… ë¹ˆ í–‰ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');

                await loadTruckData();

            } catch (error) {
                console.error('âŒ Delete error:', error);
                console.warn('âš ï¸ ë¹ˆ í–‰ ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
                 // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
         function refreshData() {
             console.log('ğŸ”„ Refreshing data...');
             loadTruckData();
         }
         
         // í˜„ì¬ ë‚ ì§œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
         async function refreshCurrentDateData() {
             console.log('ğŸ”„ Refreshing current date data...');
             await autoFilterByDate();
         }
        
        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        function showLoading() {
            const container = document.getElementById('truckTableContainer');
            container.innerHTML = `
                <div class="loading">
                    <div class="loading-icon">ğŸ”„</div>
                    <div>Loading truck data...</div>
                </div>
            `;
        }
        
        // ì—ëŸ¬ ìƒíƒœ í‘œì‹œ
        function showError(message) {
            const container = document.getElementById('truckTableContainer');
            container.innerHTML = `
                <div class="error">
                    <div class="error-icon">âŒ</div>
                    <div>${message}</div>
                </div>
            `;
        }
        
        // ë°ì´í„° ì—†ìŒ ìƒíƒœ í‘œì‹œ
        function showNoData() {
            const container = document.getElementById('truckTableContainer');
            container.innerHTML = `
                <div class="loading">
                    <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ“­</div>
                    <div>íŠ¸ëŸ­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            `;
        }
        
        // 1ì‹œê°„ ë‹¨ìœ„ ì‹œê°„ ì˜µì…˜ ìƒì„±
        function generateTimeOptions() {
            const options = [];
            for (let hour = 0; hour < 24; hour++) {
                const timeString = hour.toString().padStart(2, '0') + ':00';
                options.push(timeString);
            }
            return options;
        }
        
         // ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš© - ë” ê°•ë ¥í•œ ì„ íƒì ì‚¬ìš©
         function forceDropdownStyling() {
             console.log('ğŸ¨ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš© ì¤‘...');
             
             // ëª¨ë“  ê°€ëŠ¥í•œ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìš”ì†Œ ì°¾ê¸° (ë” í¬ê´„ì ì¸ ì„ íƒì)
             const dropdownMenus = document.querySelectorAll('.htDropdownMenu, [class*="htDropdownMenu"], .handsontable .htDropdownMenu');
             
             console.log(`ğŸ” ë°œê²¬ëœ ë“œë¡­ë‹¤ìš´ ë©”ë‰´: ${dropdownMenus.length}ê°œ`);
             
             dropdownMenus.forEach((menu, index) => {
                 console.log(`ğŸ¨ ë©”ë‰´ ${index + 1} ìŠ¤íƒ€ì¼ ì ìš© ì¤‘...`);
                 
                 // ê¸°ë³¸ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš© (ë” ê°•ë ¥í•œ ë°©ì‹)
                 Object.assign(menu.style, {
                     zIndex: '99999',
                     maxHeight: '600px',
                     minHeight: '300px',
                     overflowY: 'auto',
                     background: 'white',
                     border: '1px solid #ccc',
                     boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
                     position: 'absolute',
                     display: 'block'
                 });
                 
                 // ë‚´ë¶€ í…Œì´ë¸” ìš”ì†Œë“¤ ìŠ¤íƒ€ì¼ ì ìš©
                 const tableElements = menu.querySelectorAll('td');
                 console.log(`ğŸ” ë©”ë‰´ ${index + 1}ì˜ í…Œì´ë¸” ìš”ì†Œ: ${tableElements.length}ê°œ`);
                 
                 tableElements.forEach((element, tdIndex) => {
                     Object.assign(element.style, {
                         padding: '12px 16px',
                         borderBottom: '1px solid #eee',
                         cursor: 'pointer',
                         whiteSpace: 'nowrap',
                         fontSize: '14px',
                         lineHeight: '1.4',
                         background: 'white',
                         color: '#333',
                         display: 'table-cell'
                     });
                 });
                 
                 // ì¶”ê°€ë¡œ CSS í´ë˜ìŠ¤ë„ ê°•ì œ ì ìš©
                 menu.classList.add('htDropdownMenu');
                 
                 console.log(`âœ… ë©”ë‰´ ${index + 1} ìŠ¤íƒ€ì¼ ì ìš© ì™„ë£Œ`);
             });
             
             // ì¶”ê°€ë¡œ CSS ìŠ¤íƒ€ì¼ì„ headì— ì£¼ì…í•˜ì—¬ ìš°ì„ ìˆœìœ„ ë†’ì´ê¸°
             if (!document.getElementById('force-dropdown-styles')) {
                 const style = document.createElement('style');
                 style.id = 'force-dropdown-styles';
                 style.textContent = `
                     .htDropdownMenu, [class*="htDropdownMenu"], .handsontable .htDropdownMenu {
                         z-index: 99999 !important;
                         max-height: 600px !important;
                         min-height: 300px !important;
                         background: white !important;
                         border: 1px solid #ccc !important;
                         box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
                     }
                     .htDropdownMenu td, [class*="htDropdownMenu"] td, .handsontable .htDropdownMenu td {
                         padding: 12px 16px !important;
                         font-size: 14px !important;
                         line-height: 1.4 !important;
                     }
                 `;
                 document.head.appendChild(style);
                 console.log('âœ… ê°•ì œ CSS ìŠ¤íƒ€ì¼ ì£¼ì… ì™„ë£Œ');
             }
         }
        
                                                                     // ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ
          window.addNewRow = addNewRow;
          window.deleteLastRow = deleteLastRow;
          window.saveAllChanges = saveAllChanges;
          window.autoFilterByDate = autoFilterByDate;
          window.deleteTruck = deleteTruck;
          window.refreshData = refreshData;
          window.refreshCurrentDateData = refreshCurrentDateData;
          window.generateTimeOptions = generateTimeOptions;
          window.forceDropdownStyling = forceDropdownStyling;
        
        console.log('âœ… Truck Management System loaded successfully');
    </script>
</body>
</html>
