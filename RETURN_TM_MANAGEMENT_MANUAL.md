# Return TM Management System 매뉴얼

## 목차
1. [시스템 개요](#시스템-개요)
2. [DESKTOP 모드](#desktop-모드)
3. [PDA 모드](#pda-모드)
4. [주의사항](#주의사항)

---

## 시스템 개요

Return TM Management 시스템은 반품 TM(Transport Module)의 팔렛 관리, 맵핑, 배송 관리를 위한 통합 시스템입니다.

### 주요 기능
- **팔렛 번호 생성**: VWRT0001부터 순차적으로 생성
- **팔렛-TM 맵핑**: 팔렛과 TM 바코드를 연결
- **배송 관리**: 맵핑된 팔렛의 배송 처리 및 배차 관리
- **이력 조회**: 맵핑/언맵핑/배송 이력 통합 조회
- **리포트**: 데이터 검색 및 엑셀 다운로드

---

## DESKTOP 모드

### 1. Pallet Generate (팔렛 생성)

**위치**: DESKTOP 모드 → Return TM Management → Pallet Generate

#### 기능
- 팔렛 번호 자동 생성 (VWRT0001, VWRT0002, ...)
- 생성된 팔렛 번호를 바코드와 함께 출력
- 여러 팔렛 동시 생성 및 출력 가능
- 재출력 기능

#### 사용 방법

1. **팔렛 생성**
   - "Number of Pallets" 입력란에 생성할 팔렛 개수 입력 (예: 20)
   - "Generate" 버튼 클릭
   - 팔렛 번호가 자동 생성되고 즉시 인쇄 대화상자가 열림

2. **종이 크기 선택**
   - **Letter (Landscape)**: 8.5" x 11" 가로 방향
   - **8" x 6"**: 8인치 x 6인치

3. **재출력**
   - 생성된 팔렛 목록에서 재출력할 팔렛 선택
   - "Print Selected" 버튼 클릭

4. **일괄 출력**
   - 여러 팔렛을 체크박스로 선택
   - "Print Selected" 버튼 클릭
   - 각 팔렛이 별도 페이지로 출력됨

#### 출력 형식
- 팔렛 번호 (큰 글씨)
- 1D 바코드
- 페이지당 1개 팔렛

---

### 2. Report (리포트)

**위치**: DESKTOP 모드 → Return TM Management → Report

#### 기능
- 맵핑 데이터 검색 및 필터링
- 엑셀 파일 다운로드 (필터 적용, 날짜별 시트 생성)

#### 사용 방법

1. **검색 조건 입력**
   - **Pallet No**: 팔렛 번호로 검색
   - **TM No**: TM 번호로 검색
   - **Mapping Date**: 맵핑 날짜로 검색
   - **Shipped Date**: 배송 날짜로 검색
   - 하나 이상의 조건 입력 후 "검색" 버튼 클릭

2. **결과 확인**
   - 검색 결과가 테이블에 표시됨
   - 컬럼: Pallet No, TM No, Mapping Date, Shipped Date, Batch

3. **Excel 다운로드**
   - "Excel 다운로드" 버튼 클릭
   - 날짜 선택 다이얼로그 표시
   - Shipped Date 선택 (기본값: 오늘 날짜)
   - "다운로드" 버튼 클릭

#### Excel 파일 구성

**시트 1: All Data**
- 검색된 전체 데이터
- 컬럼: Pallet No, TM No, Mapping Date, Shipped Date, Batch
- 자동 필터 적용

**시트 2: 선택한 날짜 (예: 2024-01-15)**
- 선택한 날짜의 shipped date가 있는 데이터
- 컬럼: Date, Batch, Pallet No, TM No
- 날짜와 차수별로 그룹화
- 자동 필터 적용

**시트 3: Shipping Summary**
- 날짜별 배송 요약
- 컬럼: Shipping Date, 차량수(차수), TM Qty
- 자동 필터 적용

#### 필터 없을 때
- 필터 조건 없이 "Excel 다운로드" 클릭 시 전체 데이터 자동 조회 후 다운로드

---

### 3. Mapping History (맵핑 이력)

**위치**: DESKTOP 모드 → Return TM Management → Mapping History

#### 기능
- 맵핑/언맵핑/배송 이력 통합 조회
- 현재 맵핑 데이터와 히스토리 데이터 통합 표시
- 엑셀 다운로드

#### 사용 방법

1. **검색 조건 입력**
   - **Pallet No**: 팔렛 번호로 검색
   - **TM No**: TM 번호로 검색
   - **Mapping Date**: 맵핑 날짜로 검색
   - 하나 이상의 조건 입력 후 "검색" 버튼 클릭

2. **결과 확인**
   - 검색 결과가 테이블에 표시됨
   - 컬럼: Status, Pallet No, TM No, Mapping Date, Unmapping Date, Shipping Date, Batch
   - **Status 표시**:
     - **Mapped** (파란색): 현재 맵핑됨
     - **Unmapped** (노란색): 언맵핑됨
     - **Shipped** (초록색): 배송됨

3. **이력 해석**
   - 같은 팔렛+TM 조합이 여러 번 나타날 수 있음
   - 각 행은 독립적인 이벤트 (맵핑 또는 언맵핑)
   - 날짜순으로 정렬되어 표시됨

4. **Excel 다운로드**
   - "Excel 다운로드" 버튼 클릭
   - 검색된 이력 데이터가 엑셀 파일로 다운로드됨
   - 필터 없을 때는 전체 데이터 자동 조회 후 다운로드

---

## PDA 모드

### 1. Mapping (맵핑)

**위치**: PDA 모드 → Mapping

#### 기능
- 팔렛 번호와 TM 바코드를 맵핑
- 기존 맵핑된 TM 확인
- 언맵핑 기능

#### 사용 방법

1. **팔렛 번호 스캔**
   - 팔렛 바코드를 스캔
   - 팔렛 번호는 **Pallet Generate로 생성된 것만** 사용 가능
   - 스캔 후 팔렛 번호가 표시되고 TM 스캔 섹션이 나타남

2. **TM 바코드 스캔**
   - TM 바코드를 연속으로 스캔 (8-10개)
   - TM 바코드는 **12자리, 시작 숫자 2/3/7/8**만 허용
   - 스캔된 TM이 리스트에 추가됨
   - TM Count 카드에 총 개수 표시 (새로 스캔한 TM + 기존 맵핑된 TM)

3. **저장**
   - "Save" 버튼 클릭
   - 맵핑 데이터가 저장됨
   - 폼이 초기화되고 다음 팔렛 스캔 준비

4. **Clear**
   - "Clear" 버튼 클릭
   - 현재 작업 초기화
   - 팔렛 번호 스캔부터 다시 시작

5. **UNMAPPING**
   - 현재 스캔한 팔렛의 모든 맵핑을 언맵핑
   - **주의**: 이미 배송된 팔렛은 언맵핑 불가
   - 언맵핑된 데이터는 히스토리 테이블로 이동

#### 주의사항
- 팔렛 번호는 Pallet Generate로 생성된 것만 사용 가능
- TM 바코드는 12자리, 시작 숫자 2/3/7/8만 허용
- 같은 팔렛+TM 조합은 중복 맵핑 불가
- 이미 배송된 팔렛은 언맵핑 불가

---

### 2. Shipping (배송)

**위치**: PDA 모드 → Shipping

#### 기능
- 맵핑된 팔렛의 배송 처리
- 배송 날짜 및 배차 번호 자동 할당
- 여러 팔렛 일괄 처리

#### 사용 방법

1. **팔렛 번호 스캔**
   - 배송할 팔렛 바코드를 연속으로 스캔
   - 팔렛은 **이미 맵핑된 것만** 사용 가능
   - **이미 배송된 팔렛은 스캔 불가**
   - 스캔된 팔렛이 리스트에 추가됨

2. **요약 확인**
   - Summary Card에 다음 정보 표시:
     - **Pallets**: 스캔한 팔렛 개수
     - **Total TMs**: 모든 팔렛의 TM 개수 합계

3. **팔렛 제거**
   - 스캔한 팔렛 목록에서 "Remove" 버튼 클릭
   - 해당 팔렛이 목록에서 제거됨

4. **저장**
   - "Save Shipping Date" 버튼 클릭
   - 모든 스캔한 팔렛의 TM에 배송 날짜와 배차 번호가 할당됨
   - 배차 번호는 **오늘 날짜 기준으로 자동 계산** (1차, 2차, ...)
   - 저장 후 폼이 초기화됨

#### 배차 번호 규칙
- 같은 날짜에 여러 번 저장하면 배차 번호가 자동 증가
- 예: 오늘 첫 저장 = 1차, 두 번째 저장 = 2차, ...

#### 주의사항
- 맵핑되지 않은 팔렛은 스캔 불가
- 이미 배송된 팔렛은 스캔 불가
- 한 번에 여러 팔렛을 스캔하여 일괄 처리 가능

---

### 3. Find (찾기)

**위치**: PDA 모드 → Find

#### 기능
- TM 번호로 맵핑된 팔렛 찾기

#### 사용 방법

1. **TM 번호 스캔**
   - TM 바코드를 스캔
   - TM 번호는 12자리, 시작 숫자 2/3/7/8만 허용

2. **결과 확인**
   - 결과가 표시됨:
     - **TM NO**: 스캔한 TM 번호
     - **PALLET NO**: 맵핑된 팔렛 번호
   - 새로운 스캔 시 이전 결과는 대체됨

3. **초기화**
   - "Clear" 버튼 클릭
   - 결과가 지워짐

#### 주의사항
- 맵핑되지 않은 TM은 결과 없음
- 한 번에 하나의 결과만 표시 (새 스캔 시 이전 결과 대체)

---

## 주의사항

### 데이터 무결성

1. **팔렛 번호**
   - Pallet Generate로 생성된 팔렛만 사용 가능
   - 다른 시스템에서 생성된 팔렛 번호는 사용 불가

2. **TM 바코드**
   - 12자리, 시작 숫자 2/3/7/8만 허용
   - 다른 형식의 바코드는 스캔 불가

3. **중복 맵핑**
   - 같은 팔렛+TM 조합은 중복 맵핑 불가
   - 같은 TM을 다른 팔렛에 맵핑하는 것은 가능

4. **배송된 팔렛**
   - 이미 배송된 팔렛은 언맵핑 불가
   - 이미 배송된 팔렛은 Shipping에서 재스캔 불가

### PDA 스캔 주의사항

1. **포커스 관리**
   - PDA는 엔터키가 없으므로 자동 포커스 처리됨
   - 스캔 후 자동으로 다음 스캔 준비 상태로 전환

2. **연속 스캔**
   - TM 바코드는 8-10개를 연속으로 스캔 가능
   - 각 스캔 후 자동으로 다음 스캔 입력 필드로 포커스 이동

3. **스캔 오류**
   - 잘못된 바코드 스캔 시 오류 메시지 표시
   - 입력 필드가 자동으로 초기화되고 재스캔 가능

### 데이터 관리

1. **언맵핑**
   - 언맵핑된 데이터는 히스토리 테이블로 이동
   - 원본 데이터는 삭제되지만 히스토리에서 조회 가능

2. **배송 처리**
   - 배송 처리 시 배송 날짜와 배차 번호가 자동 할당
   - 배차 번호는 같은 날짜 기준으로 순차 증가

3. **이력 조회**
   - Mapping History에서 모든 맵핑/언맵핑/배송 이력 조회 가능
   - 같은 팔렛+TM 조합의 반복 이력도 모두 표시

---

## 문제 해결

### 일반적인 문제

1. **팔렛 스캔이 안 됨**
   - Pallet Generate로 생성된 팔렛인지 확인
   - 팔렛 번호 형식 확인 (VWRT0001 형식)

2. **TM 스캔이 안 됨**
   - TM 바코드가 12자리인지 확인
   - 시작 숫자가 2/3/7/8인지 확인

3. **Shipping에서 팔렛 스캔이 안 됨**
   - 팔렛이 맵핑되어 있는지 확인
   - 이미 배송된 팔렛인지 확인

4. **언맵핑이 안 됨**
   - 팔렛이 이미 배송되었는지 확인
   - 배송된 팔렛은 언맵핑 불가

### 데이터 확인

1. **Report에서 데이터 확인**
   - DESKTOP 모드 → Report에서 전체 데이터 조회
   - 필터를 사용하여 특정 데이터 검색

2. **Mapping History에서 이력 확인**
   - DESKTOP 모드 → Mapping History에서 전체 이력 조회
   - 팔렛 번호나 TM 번호로 검색

---

## 시스템 요구사항

- **브라우저**: Chrome, Edge, Safari (최신 버전)
- **PDA**: 바코드 스캐너 내장 기기
- **인터넷 연결**: 필수 (Supabase 데이터베이스 연결)

---

## 문의 및 지원

시스템 사용 중 문제가 발생하거나 문의사항이 있으면 관리자에게 문의하세요.

---

**버전**: 1.0  
**최종 업데이트**: 2024년
