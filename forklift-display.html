<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forklift Display - Packaging Order</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Forklift Display for Packaging Order Management">
    <meta name="theme-color" content="#1e40af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Forklift Display">
    <meta name="msapplication-TileColor" content="#1e40af">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Icons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöõ</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #1d4ed8 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }
        
        .notification {
            animation: slideIn 0.5s ease-out, pulse 2s infinite;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Îã§Ïùå ÏûëÏóÖ Ïπ¥Îìú Í∞ïÏ°∞ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes urgentPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(251, 146, 60, 0.7); }
            50% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(251, 146, 60, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(251, 146, 60, 0); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .urgent-next-card {
            animation: urgentPulse 2s infinite;
        }
        
        .bounce-emoji {
            animation: bounce 2s infinite;
        }
        
        .urgent-notification {
            animation: urgentPulse 1s infinite, urgentShake 0.5s infinite;
        }
        
        @keyframes urgentPulse {
            0%, 100% { background-color: #ef4444; }
            50% { background-color: #dc2626; }
        }
        
        @keyframes urgentShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .urgent-notification .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        .urgent-notification .animate-pulse {
            animation: pulse 1s infinite;
        }
        
        .order-item {
            transition: all 0.3s ease;
        }
        
        .order-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .completed-item {
            opacity: 0.6;
            background-color: #374151;
        }
    </style>
</head>
<body>
    <div class="h-screen p-4 bg-gray-900 text-white overflow-hidden">
        <!-- Header -->
        <div class="text-center mb-3 relative">
            <h2 class="text-2xl font-bold text-orange-300 mb-1">üöõ FORKLIFT DISPLAY</h2>
            <div class="text-sm text-gray-400 mb-2">PANTALLA DE MONTACARGAS</div>
            <div class="text-lg font-semibold text-yellow-300 mb-2" id="displayDate">-</div>
            <button onclick="toggleFullscreen()" id="fullscreenBtn" class="absolute top-0 right-0 bg-red-500 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-bold text-sm shadow-lg">
                <span id="fullscreenText">üñ•Ô∏è FULLSCREEN</span>
            </button>
        </div>

        <!-- Notification Area -->
        <div id="notificationArea" class="mb-4">
            <!-- Notifications will appear here -->
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 flex-1">
            <!-- Left Column: Current & Next Orders -->
            <div class="space-y-4">
                <!-- Current Order Status -->
                <div class="bg-gray-800 rounded-xl shadow-xl p-4">
                    <h3 class="text-xl font-bold mb-2 text-center text-green-300">CURRENT STATUS</h3>
                    <div class="text-sm text-gray-400 mb-3 text-center">ESTADO ACTUAL</div>
                    <div class="bg-gray-700 rounded-lg p-4 border-2 border-green-500 flex items-center justify-between">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-blue-300" id="currentPart">-</div>
                            <div class="text-sm text-gray-400">PART NO</div>
                            <div class="text-xs text-gray-500">NO. DE PIEZA</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-yellow-300" id="currentSeq">-</div>
                            <div class="text-sm text-gray-400">SEQ</div>
                            <div class="text-xs text-gray-500">SECUENCIA</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-300" id="currentStatus">WAITING</div>
                            <div class="text-sm text-gray-400">STATUS</div>
                            <div class="text-xs text-gray-500">ESTADO</div>
                        </div>
                    </div>
                </div>

                <!-- Next Orders -->
                <div class="bg-gray-800 rounded-xl shadow-xl p-4 border-2 border-orange-400">
                    <h3 class="text-2xl font-bold mb-2 text-center text-orange-300 animate-pulse">NEXT WORK</h3>
                    <div class="text-sm text-gray-400 mb-4 text-center">PR√ìXIMO TRABAJO</div>
                    <div class="space-y-4">
                        <!-- Next Order - Í∞ÄÏû• Ï§ëÏöîÌïú Ïπ¥Îìú -->
                        <div class="bg-gradient-to-r from-orange-600 to-orange-700 rounded-xl p-4 border-4 border-orange-400 shadow-2xl transform hover:scale-105 transition-all duration-300 urgent-next-card">
                            <div class="flex items-center justify-between">
                                <div class="text-center flex-1">
                                    <div class="text-4xl font-bold text-white mb-2" id="nextPart">-</div>
                                    <div class="text-sm font-semibold text-orange-200">NEXT WORK</div>
                                    <div class="text-xs text-orange-100">PR√ìXIMO TRABAJO</div>
                                </div>
                                <div class="text-center flex-1">
                                    <div class="text-3xl font-bold text-yellow-300" id="nextSeq">-</div>
                                    <div class="text-sm font-semibold text-orange-200">SEQUENCE</div>
                                    <div class="text-xs text-orange-100">SECUENCIA</div>
                                </div>
                                <div class="text-center flex-1">
                                    <div class="text-2xl bounce-emoji">üì¶</div>
                                    <div class="text-sm font-semibold text-orange-200">PREPARE</div>
                                    <div class="text-xs text-orange-100">PREPARAR</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- After Next Order - Îëê Î≤àÏß∏ Ïπ¥Îìú -->
                        <div class="bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-xl p-4 border-4 border-yellow-400 shadow-xl">
                            <div class="flex items-center justify-between">
                                <div class="text-center flex-1">
                                    <div class="text-3xl font-bold text-white mb-2" id="afterNextPart">-</div>
                                    <div class="text-sm font-semibold text-yellow-200">AFTER NEXT</div>
                                    <div class="text-xs text-yellow-100">DESPU√âS</div>
                                </div>
                                <div class="text-center flex-1">
                                    <div class="text-2xl font-bold text-yellow-300" id="afterNextSeq">-</div>
                                    <div class="text-sm font-semibold text-yellow-200">SEQUENCE</div>
                                    <div class="text-xs text-yellow-100">SECUENCIA</div>
                                </div>
                                <div class="text-center flex-1">
                                    <div class="text-xl">‚è≥</div>
                                    <div class="text-sm font-semibold text-yellow-200">WAITING</div>
                                    <div class="text-xs text-yellow-100">ESPERANDO</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Today's Order List -->
            <div class="bg-gray-800 rounded-xl shadow-xl p-4">
                <h3 class="text-lg font-bold mb-2 text-center text-orange-300">TODAY'S ORDER LIST</h3>
                <div class="text-sm text-gray-400 mb-3 text-center">LISTA DE TRABAJOS DE HOY</div>
                <div class="overflow-y-auto h-[500px]">
                    <div id="orderList" class="space-y-2">
                        <!-- Order items will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase ÏÑ§Ï†ï
        const SUPABASE_URL = 'https://wfnihtmmaebgjtdmazmo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndmbmlodG1tYWViZ2p0ZG1hem1vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NTY3NTcsImV4cCI6MjA2NTMzMjc1N30.FYfdgSvOT1qUvANGlqXCEGvSR2JujggU7T_Sjzys3HQ';
        
        // Supabase ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉùÏÑ±
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            autoRefreshToken: true,
            persistSession: true
        });

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let forkliftScheduleData = [];
        let refreshInterval = null;
        let notificationTimeout = null;

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöõ Forklift Display initialized');
            updateDisplayDate();
            loadForkliftScheduleData();
            startAutoRefresh();
            
            // Supabase Ïã§ÏãúÍ∞Ñ Íµ¨ÎèÖ ÏÑ§Ï†ï
            setupRealtimeSubscription();
            
            // PWA Service Worker Îì±Î°ù
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úÖ Forklift Display PWA Service Worker Îì±Î°ù ÏÑ±Í≥µ:', registration.scope);
                    })
                    .catch(error => {
                        console.log('‚ùå Forklift Display PWA Service Worker Îì±Î°ù Ïã§Ìå®:', error);
                    });
            }
            
            // PWA ÏÑ§Ïπò ÏïàÎÇ¥
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallButton();
            });
            
            function showInstallButton() {
                const installButton = document.createElement('button');
                installButton.innerHTML = 'üì± Forklift App ÏÑ§ÏπòÌïòÍ∏∞';
                installButton.className = 'fixed top-4 left-4 bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                installButton.onclick = () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('‚úÖ Forklift Display PWA ÏÑ§ÏπòÎê®');
                            }
                            deferredPrompt = null;
                            installButton.remove();
                        });
                    }
                };
                document.body.appendChild(installButton);
                
                // 15Ï¥à ÌõÑ ÏûêÎèô Ïà®ÍπÄ
                setTimeout(() => {
                    if (installButton.parentNode) {
                        installButton.remove();
                    }
                }, 15000);
            }
        });

        // Ïã§ÏãúÍ∞Ñ Íµ¨ÎèÖ ÏÑ§Ï†ï
        function setupRealtimeSubscription() {
            const channel = supabase
                .channel('forklift-display')
                .on('postgres_changes', 
                    { 
                        event: 'UPDATE', 
                        schema: 'public', 
                        table: 'tm_packaging_schedule',
                        filter: 'work_status=eq.completed'
                    }, 
                    (payload) => {
                        console.log('üîî Real-time update received:', payload);
                        handleCompletionNotification(payload.new);
                    }
                )
                .subscribe();

            console.log('üì° Real-time subscription established');
        }

        // ÏôÑÎ£å ÏïåÎ¶º Ï≤òÎ¶¨
        function handleCompletionNotification(completedItem) {
            console.log('‚úÖ Completion notification:', completedItem);
            
            // Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ® (ÏôÑÎ£åÎêú ÏûëÏóÖ Ìè¨Ìï®)
            loadForkliftScheduleData();
            
            // ÏôÑÎ£åÎêú ÏûëÏóÖÏóê ÎåÄÌïú Í∞ïÎ†•Ìïú ÏïåÎ¶º ÌëúÏãú
            showUrgentNotification(completedItem);
            
            // ÏÇ¨Ïö¥Îìú ÏïåÎ¶º
            playNotificationSound();
            
            // ÌôîÎ©¥ ÍπúÎπ°ÏûÑ Ìö®Í≥º
            flashScreen();
        }

        // Í∏¥Í∏â ÏïåÎ¶º ÌëúÏãú
        function showUrgentNotification(item) {
            const notificationArea = document.getElementById('notificationArea');
            
            // Í∏∞Ï°¥ ÏïåÎ¶º Ï†úÍ±∞
            notificationArea.innerHTML = '';
            
            const notification = document.createElement('div');
            notification.className = 'urgent-notification bg-red-600 text-white p-6 rounded-lg shadow-2xl mb-4 border-4 border-yellow-400';
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-6">
                        <div class="text-4xl animate-bounce">üö®</div>
                        <div>
                            <div class="text-2xl font-bold animate-pulse">PACKAGING COMPLETED!</div>
                            <div class="text-lg">Part: ${item.part_no} | Seq: ${item.seq_no}</div>
                            <div class="text-sm text-yellow-200">¬°EMPAQUE COMPLETADO!</div>
                            <div class="text-sm text-yellow-200">Go to packaging area!</div>
                        </div>
                    </div>
                    <button onclick="dismissNotification(this)" class="text-white hover:text-gray-300 text-2xl font-bold">√ó</button>
                </div>
            `;
            
            notificationArea.appendChild(notification);
            
            // 30Ï¥à ÌõÑ ÏûêÎèô Ï†úÍ±∞ (Îçî Ïò§Îûò ÌëúÏãú)
            notificationTimeout = setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 30000);
        }
        
        // ÏôÑÎ£åÎêú ÏûëÏóÖ ÏïåÎ¶º ÌëúÏãú
        function showCompletedWorkNotification(item) {
            const notificationArea = document.getElementById('notificationArea');
            
            // Í∏∞Ï°¥ ÏïåÎ¶º Ï†úÍ±∞
            notificationArea.innerHTML = '';
            
            const notification = document.createElement('div');
            notification.className = 'urgent-notification bg-orange-600 text-white p-6 rounded-lg shadow-2xl mb-4 border-4 border-red-400';
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-6">
                        <div class="text-4xl animate-bounce">üßπ</div>
                        <div>
                            <div class="text-2xl font-bold animate-pulse">CLEAN UP COMPLETED WORK!</div>
                            <div class="text-lg">Part: ${item.part_no} | Seq: ${item.seq_no}</div>
                            <div class="text-sm text-orange-200">¬°LIMPIAR TRABAJO COMPLETADO!</div>
                            <div class="text-sm text-orange-200">Remove this completed work!</div>
                        </div>
                    </div>
                    <button onclick="dismissNotification(this)" class="text-orange-200 hover:text-white text-2xl font-bold">√ó</button>
                </div>
            `;
            
            notificationArea.appendChild(notification);
            
            // 60Ï¥à ÌõÑ ÏûêÎèô Ï†úÍ±∞
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 60000);
        }

        // ÏÇ¨Ïö¥Îìú ÏïåÎ¶º
        function playNotificationSound() {
            try {
                // Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÏßÄÏõêÌïòÎäî ÏÇ¨Ïö¥Îìú Ïû¨ÏÉù
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Í≤ΩÍ≥†Ïùå Ìå®ÌÑ¥ (3Î≤à Î∞òÎ≥µ)
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
                
                // 0.5Ï¥à ÌõÑ Îã§Ïãú Ïû¨ÏÉù
                setTimeout(() => {
                    const oscillator2 = audioContext.createOscillator();
                    const gainNode2 = audioContext.createGain();
                    
                    oscillator2.connect(gainNode2);
                    gainNode2.connect(audioContext.destination);
                    
                    oscillator2.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator2.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);
                    oscillator2.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
                    
                    gainNode2.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator2.start(audioContext.currentTime);
                    oscillator2.stop(audioContext.currentTime + 0.3);
                }, 500);
                
            } catch (error) {
                console.log('ÏÇ¨Ïö¥Îìú Ïû¨ÏÉù Ïã§Ìå®:', error);
            }
        }
        
        // ÏôÑÎ£åÎêú ÏûëÏóÖ ÏÇ¨Ïö¥Îìú ÏïåÎ¶º
        function playCompletedWorkSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // ÏôÑÎ£åÎêú ÏûëÏóÖ ÏïåÎ¶ºÏùå Ìå®ÌÑ¥ (Îçî Í∏¥ Ìå®ÌÑ¥)
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.4);
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.6);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.8);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.0);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1.0);
                
            } catch (error) {
                console.log('ÏôÑÎ£åÎêú ÏûëÏóÖ ÏÇ¨Ïö¥Îìú Ïû¨ÏÉù Ïã§Ìå®:', error);
            }
        }

        // ÌôîÎ©¥ ÍπúÎπ°ÏûÑ Ìö®Í≥º
        function flashScreen() {
            const body = document.body;
            let flashCount = 0;
            const maxFlashes = 6;
            
            const flashInterval = setInterval(() => {
                if (flashCount >= maxFlashes) {
                    clearInterval(flashInterval);
                    body.style.backgroundColor = '';
                    return;
                }
                
                body.style.backgroundColor = flashCount % 2 === 0 ? '#ff4444' : '#1e3a8a';
                flashCount++;
            }, 200);
        }

        // ÏïåÎ¶º Ï†úÍ±∞
        function dismissNotification(button) {
            const notification = button.closest('.urgent-notification');
            if (notification) {
                notification.remove();
            }
        }
        
        // ÏôÑÎ£åÎêú ÏûëÏóÖ ÏïåÎ¶º Ï†úÍ±∞
        function dismissCompletedNotification(button) {
            const notification = button.closest('.urgent-notification');
            if (notification) {
                notification.remove();
            }
        }

        // ÎÇ†Ïßú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateDisplayDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            // ÏòÅÎ¨∏ ÎÇ†Ïßú ÌëúÏãú
            const englishDate = now.toLocaleDateString('en-US', options);
            // Ïä§ÌéòÏù∏Ïñ¥ ÎÇ†Ïßú ÌëúÏãú
            const spanishDate = now.toLocaleDateString('es-ES', options);
            
            document.getElementById('displayDate').innerHTML = `
                <div>${englishDate}</div>
                <div class="text-sm text-gray-400">${spanishDate}</div>
            `;
        }

        // Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadForkliftScheduleData() {
            try {
                console.log('üìä Loading forklift schedule data...');
                
                const today = new Date().toISOString().split('T')[0];
                
                const { data, error } = await supabase
                    .from('tm_packaging_schedule')
                    .select('*')
                    .eq('work_date', today)
                    .order('seq_no', { ascending: true });
                
                if (error) throw error;
                
                forkliftScheduleData = data || [];
                console.log('‚úÖ Forklift schedule data loaded:', forkliftScheduleData);
                
                displayOrderList();
                updateCurrentOrder();
                
            } catch (error) {
                console.error('Error loading forklift schedule data:', error);
                console.warn('‚ö†Ô∏è Unable to load data. Please check Supabase connection.');
                forkliftScheduleData = [];
                displayOrderList();
            }
        }

        // Ï£ºÎ¨∏ Î™©Î°ù ÌëúÏãú
        function displayOrderList() {
            const orderList = document.getElementById('orderList');
            let html = '';
            
            if (forkliftScheduleData.length === 0) {
                html = '<div class="text-center text-gray-400 py-8">No orders for today</div>';
            } else {
                forkliftScheduleData.forEach((item, index) => {
                    const status = getCalculatedStatus(item);
                    const statusText = getStatusText(status);
                    const bgColor = getStatusBackgroundColor(status);
                    const opacityClass = status === 'completed' ? 'completed-item' : '';
                    
                    html += `
                        <div class="order-item ${bgColor} rounded-lg p-3 border-l-4 ${getStatusBorderColor(status)} ${opacityClass}">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="text-lg font-bold text-white">${item.seq_no}</div>
                                    <div class="text-xl font-bold text-white">${item.part_no || '-'}</div>
                                    <div class="text-sm text-gray-300">${item.work_start_time || 'Not Started'}</div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 rounded-full text-xs font-semibold ${getStatusBadgeColor(status)}">
                                        ${statusText}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            orderList.innerHTML = html;
        }

        // ÌòÑÏû¨ Ï£ºÎ¨∏ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateCurrentOrder() {
            const activeItem = forkliftScheduleData.find(item => item.work_status === 'active');
            // Í∞ÄÏû• ÏµúÍ∑ºÏóê ÏôÑÎ£åÎêú ÏûëÏóÖÏùÑ Ï∞æÏùå (Î∞∞Ïó¥Ïùò ÎßàÏßÄÎßâ completed Ìï≠Î™©)
            const completedItems = forkliftScheduleData.filter(item => item.work_status === 'completed');
            const completedItem = completedItems.length > 0 ? completedItems[completedItems.length - 1] : null;
            
            if (activeItem) {
                // ÌòÑÏû¨ ÏßÑÌñâÏ§ëÏù∏ ÏûëÏóÖ (Ìè¨Ïû•Ï§ë)
                document.getElementById('currentPart').textContent = activeItem.part_no || '-';
                document.getElementById('currentSeq').textContent = activeItem.seq_no;
                document.getElementById('currentStatus').textContent = 'üîÑ PACKAGING';
                document.getElementById('currentStatus').className = 'text-2xl font-bold text-green-300';
            } else if (completedItem) {
                // ÏôÑÎ£åÎêú ÏûëÏóÖÏù¥ ÏûàÏùå - ÏπòÏö∞Í≥† Îã§Ïùå ÏûëÏóÖ Ï§ÄÎπÑ
                document.getElementById('currentPart').textContent = completedItem.part_no || '-';
                document.getElementById('currentSeq').textContent = completedItem.seq_no;
                document.getElementById('currentStatus').textContent = 'üßπ CLEAN UP';
                document.getElementById('currentStatus').className = 'text-2xl font-bold text-red-300 animate-pulse';
                
                // ÏôÑÎ£åÎêú ÏûëÏóÖÏóê ÎåÄÌïú Í∏¥Í∏â ÏïåÎ¶º ÌëúÏãú
                showCompletedWorkNotification(completedItem);
                
                // ÏôÑÎ£åÎêú ÏûëÏóÖÏóê ÎåÄÌïú ÏÇ¨Ïö¥Îìú ÏïåÎ¶º
                playCompletedWorkSound();
            } else {
                // ÌòÑÏû¨ ÏßÑÌñâÏ§ëÏù∏ ÏûëÏóÖÏù¥ ÏóÜÏùå
                document.getElementById('currentPart').textContent = '-';
                document.getElementById('currentSeq').textContent = '-';
                document.getElementById('currentStatus').textContent = 'üìã WAITING';
                document.getElementById('currentStatus').className = 'text-2xl font-bold text-gray-300';
            }
            
            // Îã§Ïùå ÏûëÏóÖÎì§ ÏóÖÎç∞Ïù¥Ìä∏
            updateNextOrders();
        }

        // Îã§Ïùå ÏûëÏóÖÎì§ ÏóÖÎç∞Ïù¥Ìä∏
        function updateNextOrders() {
            const waitingItems = forkliftScheduleData.filter(item => item.work_status === 'waiting').sort((a, b) => a.seq_no - b.seq_no);
            
            // Îã§Ïùå ÏûëÏóÖ (1ÏàúÏúÑ) - Í∞ÄÏû• Î®ºÏ†Ä Ìï¥Ïïº Ìï† ÏûëÏóÖ
            if (waitingItems.length > 0) {
                const nextItem = waitingItems[0];
                document.getElementById('nextPart').textContent = nextItem.part_no || '-';
                document.getElementById('nextSeq').textContent = nextItem.seq_no;
                
                // Îã§Ïùå ÏûëÏóÖ Ïπ¥ÎìúÏóê Ï∂îÍ∞Ä Ï†ïÎ≥¥ ÌëúÏãú
                const nextCard = document.querySelector('.urgent-next-card');
                if (nextCard) {
                    nextCard.classList.add('urgent-next-card');
                    nextCard.style.animation = 'urgentPulse 2s infinite';
                }
            } else {
                document.getElementById('nextPart').textContent = 'NO WORK';
                document.getElementById('nextSeq').textContent = '-';
            }
            
            // Îã§Îã§Ïùå ÏûëÏóÖ (2ÏàúÏúÑ) - Í∑∏ Îã§ÏùåÏóê Ìï¥Ïïº Ìï† ÏûëÏóÖ
            if (waitingItems.length > 1) {
                const afterNextItem = waitingItems[1];
                document.getElementById('afterNextPart').textContent = afterNextItem.part_no || '-';
                document.getElementById('afterNextSeq').textContent = afterNextItem.seq_no;
            } else {
                document.getElementById('afterNextPart').textContent = 'NO WORK';
                document.getElementById('afterNextSeq').textContent = '-';
            }
        }

        // ÏÉÅÌÉú Í≥ÑÏÇ∞
        function getCalculatedStatus(item) {
            if (item.work_status) {
                return item.work_status;
            }
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            if (item.work_start_time) {
                const [startHour, startMin] = item.work_start_time.split(':').map(Number);
                const startTime = startHour * 60 + startMin;
                
                if (currentTime >= startTime) {
                    if (item.work_end_time) {
                        return 'completed';
                    } else {
                        return 'active';
                    }
                }
            }
            
            return 'waiting';
        }

        // ÏÉÅÌÉú ÌÖçÏä§Ìä∏
        function getStatusText(status) {
            switch (status) {
                case 'waiting': return 'üì¶ PREPARE';
                case 'active': return 'üîÑ PACKAGING';
                case 'completed': return 'üßπ CLEAN UP';
                default: return '‚ùì UNKNOWN';
            }
        }

        // ÏÉÅÌÉúÎ≥Ñ Î∞∞Í≤ΩÏÉâ
        function getStatusBackgroundColor(status) {
            switch (status) {
                case 'waiting': return 'bg-orange-500';
                case 'active': return 'bg-green-500';
                case 'completed': return 'bg-gray-600';
                default: return 'bg-gray-500';
            }
        }

        // ÏÉÅÌÉúÎ≥Ñ ÌÖåÎëêÎ¶¨ÏÉâ
        function getStatusBorderColor(status) {
            switch (status) {
                case 'waiting': return 'border-orange-300';
                case 'active': return 'border-green-300';
                case 'completed': return 'border-gray-400';
                default: return 'border-gray-300';
            }
        }

        // ÏÉÅÌÉúÎ≥Ñ Î∞∞ÏßÄÏÉâ
        function getStatusBadgeColor(status) {
            switch (status) {
                case 'waiting': return 'bg-orange-600 text-orange-100';
                case 'active': return 'bg-green-600 text-green-100';
                case 'completed': return 'bg-gray-600 text-gray-100';
                default: return 'bg-gray-600 text-gray-100';
            }
        }

        // ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ÏãúÏûë
        function startAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            refreshInterval = setInterval(() => {
                loadForkliftScheduleData();
            }, 5000); // 5Ï¥àÎßàÎã§ ÏÉàÎ°úÍ≥†Ïπ®
            
            console.log('üîÑ Auto-refresh started (5s interval)');
        }

        // Ï†ÑÏ≤¥ÌôîÎ©¥ ÌÜ†Í∏Ä
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    document.getElementById('fullscreenText').textContent = 'üñ•Ô∏è EXIT FULLSCREEN';
                });
            } else {
                document.exitFullscreen().then(() => {
                    document.getElementById('fullscreenText').textContent = 'üñ•Ô∏è FULLSCREEN';
                });
            }
        }

        // SUPERVISOR CONTROLÏóêÏÑú Ìò∏Ï∂úÎêòÎäî ÏïåÎ¶º Ìï®Ïàò
        function showForkliftNotification(seqNo) {
            console.log(`üöõ Forklift notification received for seq: ${seqNo}`);
            
            // Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
            loadForkliftScheduleData();
            
            // ÏôÑÎ£åÎêú ÏûëÏóÖ Ï∞æÍ∏∞
            const completedItem = forkliftScheduleData.find(item => item.seq_no === seqNo);
            if (completedItem) {
                // Í∞ïÎ†•Ìïú ÏïåÎ¶º ÌëúÏãú
                showUrgentNotification(completedItem);
                
                // ÏÇ¨Ïö¥Îìú ÏïåÎ¶º
                playNotificationSound();
                
                // ÌôîÎ©¥ ÍπúÎπ°ÏûÑ Ìö®Í≥º
                flashScreen();
            }
        }
        
        // Ï†ÑÏó≠ Ìï®ÏàòÎ°ú Îì±Î°ù (SUPERVISOR CONTROLÏóêÏÑú Ìò∏Ï∂ú)
        window.showForkliftNotification = showForkliftNotification;
        
        // ÌéòÏù¥ÏßÄ Ïñ∏Î°úÎìú Ïãú Ï†ïÎ¶¨
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            if (notificationTimeout) {
                clearTimeout(notificationTimeout);
            }
        });
    </script>
</body>
</html>
